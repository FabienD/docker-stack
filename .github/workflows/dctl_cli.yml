name: dctl tests
run-name: ${{ github.actor }} launch dctl tests
on: [push, workflow_dispatch]

jobs:
  tests:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        #os: [ubuntu-latest, macos-latest, windows-latest]
        os: [ubuntu-latest]
    
    steps:
      - uses: actions/checkout@v3
      - name: install rust
        # uses: actions-rs/toolchain@v1
        # with:
        #   toolchain: stable
        #   override: true
        run: echo "install rust"
      - name: "Prepare cache"
        # uses: actions/cache@v3
        # with:
        #   path: |
        #     ~/.cargo/bin/
        #     ~/.cargo/registry/index/
        #     ~/.cargo/registry/cache/
        #     ~/.cargo/git/db/
        #     target/
        #   key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
        run: echo "Prepare cache"
      - name: run tests
        #run: cd cli && cargo test
        run: echo "cargo test"

  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        #os: [ubuntu-latest, macos-latest, windows-latest]
        os: [ubuntu-latest]
    needs: tests
    steps:
      - if: startsWith(github.ref, 'refs/tags/')
        name: run build --release
        #run: cd cli && cargo build --release
        run: echo "cargo build --release"
      - name: save build
        # uses: actions/upload-artifact@v3
        # with:
        #   name: cli-build
        #   path: target/release/dctl*
        run: echo "Save build"
  
  release:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Create Release
        id: create_release
        run: echo "Create Release"
        # uses: actions/create-release@v1
        # env:
        #   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
        # with:
        #   tag_name: ${{ github.ref }}
        #   release_name: Release ${{ github.ref }}
        #   draft: false
        #   prerelease: false
